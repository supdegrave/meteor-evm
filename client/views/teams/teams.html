<template name="team">
  <div class="main container team">
    <div class="ui large blue header">
      <div class="ui breadcrumb">
        {{> recursiveParentBreadcrumb}}
        <div class="active section">{{name}}</div>
      </div>
    </div>
    <div class="ui divider"></div>

    <div class="ui two column stackable grid">

      <div class="column">
        <div class="ui blue segment">
          <div class="ui list blue labels">
            <div class="item">
              {{>emailWidget}}        
            </div>
            {{#each roles}}
            <div class="item">
              {{>userRole role=name}}      
            </div>
            {{/each}} 
          </div>
          
          <div style="text-align: center;">
            {{#if canEdit}}
            <div class="ui buttons">
              <div class="ui negative button" id="team-reset">Cancel</div>
              <div class="or"></div>
              <div class="ui positive button" id="team-save">Save</div>
            </div>
            {{/if}}
          </div>
        </div>
      </div>

      <div class="column">
        <div class="ui teal segment">
          <div class="ui teal header">Members:</div>
          <div class="ui horizontal divided list">
            {{#each members}}
            <a class="item" href="{{pathFor 'user' id=this}}">
              {{#if canEdit}}<i class="remove-member remove icon"></i>{{/if}}
              {{displayName this}}
            </a>
            {{/each}}
          </div>
          {{#if canEdit}}
          <div class="clear ui divider"></div>
          <button class="ui teal action button add-member" data-target="#addmember">
            <i class="plus icon"></i> 
            Add Member
          </button>
          {{/if}}
        </div>
      </div>

    </div>
    {{#if canEdit}}                                              
    <div class="ui divider"></div>
    
    <!-- create / show rotas -->
    <div class="ui two column stackable grid">
      <div class="column">
        <div class="ui blue segment">
          <div class="ui blue header">
            <div class="active section">Shifts with open requests</div>
          </div>
          
          <div class="ui list teal labels">
            {{#each openRequests}}
              <b>{{title}}</b>: 

              {{formatDateTime start 'D MMMM'}} {{formatDateTime start 'HH:mm'}} - 
              {{#if sameDate start end}}
                {{formatDateTime end 'HH:mm'}}
              {{else}}
                {{formatDateTime end 'D MMMM'}} {{formatDateTime end 'HH:mm'}} <br>
              {{/if}}

              <div style="border-top: 1px solid gray;">
                {{#each requests}}
                {{displayName .}}
                <div style="float: right;">
                <a href="#"><i class="small green checkmark icon"></i></a>
                <a href="#"><i class="small red remove icon"></i></a>
                </div>
                {{/each}}
              </div>
            {{/each}}
          </div>
        </div>        
      </div>
      
      <div class="column">
        <div class="ui teal segment">
          <div class="ui teal header">
            <div class="active section">Shift Rotas</div>
          </div>
            
            <div class="ui list teal labels">
              {{#each rotas}}
              <div>
                {{name}}      
              </div>
              {{/each}}
            </div>
  
            {{#if canEdit}}
            <div class="clear ui divider"></div>
            <button class="ui teal action button add-shift-rota" data-target="addShiftRotaModal">
              <i class="plus icon"></i> 
              Add Shift or Rota
            </button>
            {{/if}}
        </div>
      </div>
    </div>
    {{/if}}

    {{>confirmationModal}}
    {{>addMemberModal}}
    {{>shiftRotaModal}}
  </div>
</template>

<template name="recursiveParentBreadcrumb">
  {{#if parentId}} 
  {{#with getParent parentId}}
  {{> recursiveParentBreadcrumb}}
  <a class="section" href="{{pathFor 'team' name=name id=_id}}">{{name}}</a>
  <i class="right arrow icon divider"></i>
  {{/with}}
  {{/if}}
</template>